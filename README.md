# PHPweb 项目

一个基于 Bramus Router 库构建的轻量级 PHP Web 应用框架，实现了无感路由系统和现代 PHP 开发最佳实践。

## 🚀 项目概述

PHPweb 是一个简洁、可扩展的 PHP 项目框架，适合作为学习参考或小型项目的基础架构。项目展示了如何构建结构清晰、易于维护的 PHP 应用程序，提供了完整的路由系统、用户管理和错误处理机制。

## ✨ 核心特性

- 🛣️ **无感路由系统**：基于 Bramus Router 库，支持多种路由注册方式，实现智能路由匹配
- 🏗️ **清晰架构**：模块化设计，文件组织结构合理，易于扩展和维护
- 👤 **完整用户系统**：用户认证、权限管理和用户信息操作功能
- 🛡️ **完善的错误处理**：内置 404/500/501 错误页面，增强的路由错误处理
- ⚙️ **集中化配置**：所有配置集中管理，便于快速调整
- 🔧 **环境适配**：支持开发/生产环境快速切换，优化的路由匹配算法

## 📁 框架结构

PHPweb 框架采用分层架构设计，各模块职责明确，便于维护和扩展。核心结构如下：

```
PHPweb/
├── 📄 .htaccess               # Apache 重写规则，实现URL美化
├── 📄 .main_router.php        # 核心路由入口，处理所有请求
├── 📄 README.md               # 项目文档
├── 📄 index.php               # 默认首页文件
├── 📁 admin/                  # 后台管理目录
│   └── 📄 auto_router.php     # 自动路由生成器，扫描页面文件生成路由配置
├── 📁 config/                 # 配置文件目录
│   ├── 📄 .auto_router_config.php  # 自动生成的路由配置文件
│   ├── 📄 .htaccess           # 保护配置文件安全
│   ├── 📄 config.php          # 主配置文件（数据库、网站设置等）
│   └── 📄 router.php          # 自定义路由配置
├── 📁 database/               # 数据库文件目录
│   └── 📄 phpweb.sql          # 数据库初始化脚本
├── 📁 include/                # 核心包含文件目录
│   ├── 📄 .htaccess           # 保护包含文件安全
│   ├── 📄 _PRE.php            # 预处理函数库（错误处理、路由辅助函数）
│   ├── 📄 conn.php            # 数据库连接封装
│   └── 📄 debug.php           # 调试工具函数
├── 📁 libs/                   # 第三方库和核心功能库目录
│   ├── 📁 Bramus/             # Bramus Router 路由库
│   ├── 📁 function/           # 功能函数库
│   │   ├── 📄 function.php    # 通用辅助函数
│   │   └── 📄 user.php        # 用户系统核心功能
│   └── 📁 page_error/         # 错误页面模板
│       ├── 📄 .htaccess       # 保护错误页面
│       ├── 📄 404.php         # 资源不存在错误页面
│       ├── 📄 500.php         # 服务器内部错误页面
│       └── 📄 501.php         # 功能未实现错误页面
└── 📁 pages/                  # 页面文件目录（支持自动路由）
    ├── 📄 a.php               # 示例页面
    ├── 📁 headers/            # 页面头部组件
    │   ├── 📄 header.php      # 通用头部
    │   └── 📄 user.php        # 用户相关头部组件
    ├── 📄 index.php           # 示例首页
    ├── 📄 news.php            # 示例新闻页面
    └── 📁 test/               # 测试页面目录
        └── 📁 user/           # 用户功能测试页面
```

### 核心模块详解

#### 1. 路由系统（.main_router.php）
路由系统是框架的核心，负责将用户请求映射到对应的处理程序。采用四层路由优先级机制：

- **自定义路由**：在 `config/router.php` 中使用 Bramus Router 原生方式注册
- **配置文件路由**：在 `config/config.php` 中通过 `add_Page()` 函数注册
- **自动生成路由**：通过 `admin/auto_router.php` 扫描页面文件自动生成
- **数据库路由**：从数据库动态加载路由配置（可选）

#### 2. 配置系统（config/）
集中管理框架的所有配置参数：

- **config.php**：主配置文件，包含数据库连接、网站设置、调试模式等
- **router.php**：自定义路由配置，优先级最高
- **.auto_router_config.php**：自动生成的路由配置，由 `admin/auto_router.php` 生成

#### 3. 核心功能库（libs/）
框架的核心功能实现：

- **Bramus/**：路由库，提供强大的路由匹配功能
- **function/**：功能函数库，包含通用工具函数和用户系统
- **page_error/**：错误页面模板，提供友好的错误提示

#### 4. 数据库连接（include/conn.php）
封装了 mysqli 数据库连接，提供全局可用的数据库连接对象 `$conn`，支持从配置文件动态加载连接参数。

#### 5. 错误处理（include/_PRE.php）
提供统一的错误处理机制：

- **Error_404()**：资源不存在错误处理
- **Error_500()**：服务器内部错误处理
- **Error_501()**：功能未实现错误处理

#### 6. 自动路由生成（admin/auto_router.php）
实现了页面文件的自动路由扫描功能，通过解析页面文件首行的特殊注释（如 `<!-- URL {/page/index, GET} -->`）自动生成路由配置。

#### 7. 用户系统（libs/function/user.php）
完整的用户管理功能：

- 用户注册、登录、注销
- 自动登录机制（基于 Cookie）
- 用户信息管理（修改用户名、密码、邮箱等）
- 用户角色管理（普通用户、作者、管理员）

## 🚀 快速开始

### 环境要求

- PHP 5.3+
- Apache 服务器（启用 `mod_rewrite` 模块）
- MySQL 数据库（可选）

### 安装步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/1246864/PHPweb.git
   cd PHPweb
   ```

2. **配置环境**
   - 编辑 `config/config.php` 设置网站 URL 和调试模式
   - 修改数据库连接参数（如果需要）

3. **导入数据库**（可选）
   - 导入 `database/phpweb.sql` 文件到 MySQL 数据库

4. **配置 Web 服务器**
   - 确保启用 `mod_rewrite` 模块
   - 配置虚拟主机指向项目根目录
   - 确保 `.htaccess` 文件能够正常工作

5. **访问应用**
   在浏览器中访问你的域名或 `http://localhost/PHPweb`

## ⚙️ 配置系统

### 基本配置

所有配置集中在 `config/config.php` 文件中：

- **网站配置**：名称、URL、调试模式
- **数据库配置**：主机、用户名、密码、数据库名、字符集
- **路由配置**：通过 `add_Page()` 函数添加路由

### 路由配置示例

```php
// 基本路由
add_Page('/', 'index.php');
add_Page('/test', 'test.php');

// 带参数的路由
add_Page('/user/{id}', 'user/profile.php');

// 指定请求方法的路由
add_Page('/api/data', 'api/data.php', 'POST');
```

## 📖 使用指南

### 添加新路由

支持多种路由注册方式，优先级从高到低：

**方法1：Bramus Router 原版注册**
```php
// 在 config/router.php 中
$router->get('/new-page', function () {
    include __DIR__ . '/../new-page.php';
});
```

**方法2：配置文件注册**
```php
// 在 config/config.php 中
add_Page('/new-page', 'new-page.php');

// 带参数的路由
add_Page('/product/{id}', 'product/details.php');
```

**方法3：页面内联注册**
```php
// 在页面文件首行添加
<!-- URL {/new-page, GET} -->
<!DOCTYPE html>
<html>
<!-- 页面内容 -->
</html>
```

**方法4：自动路由扫描**
```php
// 运行自动路由生成器
php admin/auto_router.php
```

### 创建新页面

1. 在 `pages/` 目录下创建页面文件
2. 在文件首行添加路由注释（如 `<!-- URL {/new-page} -->`）
3. 运行自动路由生成器或手动添加路由
4. 通过 `$_GET['URL']` 访问路由参数

### 数据库操作

```php
// 引入数据库连接
require_once __DIR__ . '/include/conn.php';

// 执行查询
$result = mysqli_query($conn, "SELECT * FROM users");
```

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 📝 版本更新历史

### 1.0.0
- **框架稳定版发布**：完成核心功能开发和测试
- **架构优化**：完善项目结构，确保各模块职责清晰
- **功能增强**：提升路由系统性能，完善用户系统功能
- **文档完善**：更新框架结构文档，提供更详细的使用指南

### 0.3.0
- **路由系统完善**：实现页面内URL标记自动扫描和路由注册
- **路由注册方式**：完善路由系统核心逻辑，支持四种路由注册方式
- **自动路由生成器**：添加自动路由生成器，支持批量扫描和冲突检测
- **性能优化**：优化路由匹配算法，提升路由匹配效率
- **错误处理**：增强路由错误处理和调试信息输出
- **用户系统**：完善用户管理函数，实现基础封装

### 0.2.4
- **功能新增**：实现了基础的用户登录、注册功能
- **优化改进**：添加了用户名/邮箱重复检查

### 0.2.3
- **修复改进**：修复了多个已知Bug

### 0.2.2
- **配置更新**：优化了系统配置结构

### 0.2.1
- **文档完善**：更新了README.md，提供更详细的项目介绍

### 0.2.0
- **核心功能**：集成Bramus Router路由系统
- **架构更新**：重构了路由处理逻辑

### 0.1.0
- **初始版本**：项目基础框架搭建完成
- **核心功能**：实现了基础的页面访问和路由功能

## 🙏 致谢

- [Bramus Router](https://github.com/bramus/router) - 强大的 PHP 路由库
- 所有贡献者和支持者

---

⭐ 如果这个项目对你有帮助，请给它一个星标！